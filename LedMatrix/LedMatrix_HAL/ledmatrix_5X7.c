/*
 * ledmatrix_5X7.c
 *
 * Created: 9/22/2016 1:02:06 AM
 *  Author: AhmedShaarawy
 */ 


#include "../LedMatrix_HAL/ledmatrix_5X7.h"

U8 LMTRX5x7_DrawAlpha( U8 alpha, U16 timeDelay_ms )
{
	U8 check = 0, i= 0, k= 0, column= 0;
	U16 x= 0, j= 0;
	U8 alpha_draw[26][5]= {
		{0x01, 0xF6, 0xF6, 0xF6, 0x01}, // a
		{0x41, 0x36, 0x36, 0x36, 0x00}, // b
		{0x5D, 0x3E, 0x3E, 0x3E, 0x41}, // c
		{0x41, 0x3E, 0x3E, 0x3E, 0x00}, // d
		{0x36, 0x36, 0x36, 0x36, 0x00}, // e
		{0x76, 0x76, 0x76, 0x76, 0x00}, // f
		{0x45, 0x36, 0x36, 0x3E, 0x41}, // g
		{0x00, 0x77, 0x77, 0x77, 0x00}, // h
		{0x3E, 0x3E, 0x00, 0x3E, 0x3E}, // I
		{0x40, 0x3E, 0x3E, 0x3F, 0x5F}, // j
		{0x3E, 0x5D, 0x6B, 0x77, 0x00}, // k
		{0x1F, 0x3F, 0x3F, 0x3F, 0x00}, // l
		{0x00, 0x7D, 0x7B, 0x7D, 0x00}, // m
		{0x00, 0x5F, 0x6F, 0x77, 0x00}, // n
		{0x41, 0x3E, 0x3E, 0x3E, 0x41}, // o
		{0x79, 0x76, 0x76, 0x76, 0x00}, // p
		{0x21, 0x5E, 0x2E, 0x3E, 0x41}, // q
		{0x19, 0x66, 0x76, 0x76, 0x00}, // r
		{0x4D, 0x36, 0x36, 0x36, 0x59}, // s
		{0x7E, 0x7E, 0x00, 0x7E, 0x7E}, // t
		{0x40, 0x3F, 0x3F, 0x3F, 0x40}, // u
		{0x60, 0x5F, 0x3F, 0x5F, 0x60}, // v
		{0x00, 0x5F, 0x6F, 0x5F, 0x00}, // w 
		{0x1C, 0x6B, 0x77, 0x6B, 0x1C}, // x
		{0x7C, 0x7B, 0x07, 0x7B, 0x7C}, // y
		{0x3C, 0x3A, 0x36, 0x2E, 0x1E}  // z

	};
	
	if(		TRUE_ALPHA(alpha) 
			&& TRUE_DELAY(timeDelay_ms) 
			&& TRUE_PORT(LMatrix.RowPort) 
			&& TRUE_PORT(LMatrix.ColumnPort)
			&& TRUE_ROWPIN(LMatrix.FirstRowPin)
			&& TRUE_COLUMNPIN(LMatrix.FirstColumnPin)	)
	{
		check= 1;
		IO_PortRangeDir(LMatrix.ColumnPort,LMatrix.FirstColumnPin,LMatrix.FirstColumnPin+4,OUTPUT);
		IO_PortRangeDir(LMatrix.RowPort,LMatrix.FirstRowPin,LMatrix.FirstRowPin+6,OUTPUT);
		
		for( i= 0 ; i< timeDelay_ms/100 ; i++ )
			for( j= 0; j< 1500 ; j++) // 10 ms when F_CPU= 8000,000
			{
				for( k= 0, column= 1 ; k< 5 ; k++, column<<=1, x= 0 )
				{
					PORT(LMatrix.ColumnPort)= column;
					PORT(LMatrix.RowPort)= alpha_draw[alpha-65][k];
					while(x++ < 17);
				}
				IO_PortWrite(LMatrix.RowPort,0xff);
			}
	}
	return check ;
}


U8 LMTRX5x7_DrawDigit( U8 digit, U16 timeDelay_ms )
{
	U8 check = 0, i= 0, k= 0, column= 0;
	U16 x= 0, j= 0;
	U8 digit_draw[10][5]= {
		{0x41, 0x3A, 0x36, 0x2E, 0x41}, // 0
		{0x3F, 0x3F, 0x00, 0x3D, 0x3B}, // 1
		{0x3D, 0x3A, 0x36, 0x2E, 0x1D}, // 2
		{0x4E, 0x34, 0x32, 0x36, 0x3E}, // 3
		{0x00, 0x77, 0x76, 0x75, 0x73}, // 4
		{0x4E, 0x36, 0x36, 0x36, 0x30}, // 5
		{0x0E, 0x36, 0x36, 0x36, 0x41}, // 6
		{0x78, 0x76, 0x6E, 0x5E, 0x3E}, // 7
		{0x41, 0x36, 0x36, 0x36, 0x41}, // 8
		{0x41, 0x36, 0x36, 0x36, 0x31}  // 9
	};
	
	if(		TRUE_DIGIT(digit)
			&& TRUE_DELAY(timeDelay_ms)
			&& TRUE_PORT(LMatrix.RowPort)
			&& TRUE_PORT(LMatrix.ColumnPort)
			&& TRUE_ROWPIN(LMatrix.FirstRowPin)
			&& TRUE_COLUMNPIN(LMatrix.FirstColumnPin)	)
	{
		check= 1;
		IO_PortRangeDir(LMatrix.ColumnPort,LMatrix.FirstColumnPin,LMatrix.FirstColumnPin+4,OUTPUT);
		IO_PortRangeDir(LMatrix.RowPort,LMatrix.FirstRowPin,LMatrix.FirstRowPin+6,OUTPUT);
		
		for( i= 0 ; i< timeDelay_ms/100 ; i++ )
		for( j= 0; j< 1500 ; j++) // 10 ms when F_CPU= 8000,000
		{
			for( k= 0, column= 1 ; k< 5 ; k++, column<<=1 )
			{
				PORT(LMatrix.ColumnPort)= column;
				PORT(LMatrix.RowPort)= digit_draw[digit-48][k];
				x= 0;	while(x++ < 17);
			}
			IO_PortWrite(LMatrix.RowPort,0xff);
		}
	}
	return check ;
}
